schemaVersion: 1.0.0
label: Agent Network 1
brokers:
    hbr-cms-card-agent:
        spec:
            card:
                protocolVersion: 0.3.0
                name: HBR CMS Card Agent
                description: Agent broker network that retrieves credit card information from a CMS server using MCP server and agent integration for secure customer data handling
                url: ${ingressgw.url}/hbr-cms-card-agent
                capabilities:
                    pushNotifications: true
                version: 1.0.0
                securitySchemes: {}
                defaultInputModes:
                    - application/json
                    - text/plain
                defaultOutputModes:
                    - application/json
                    - text/plain
                skills:
                    - id: credit-card-retrieval
                      name: Credit Card Information Retrieval
                      description: Securely retrieve customer credit card information from CMS server using MCP integration
                      examples:
                          - "Get credit card information for customer ID 12345"
                          - "Retrieve payment details for account holder John Smith"
                          - "Fetch card details for customer with email john.doe@example.com"
                      inputModes:
                          - application/json
                          - text/plain
                      outputModes:
                          - application/json
                          - text/plain
                      tags: ["credit-card", "cms", "customer-data", "payment"]
            llm:
                ref:
                    name: azure-openai
                configuration:
                    model: gpt-4
            instructions:
                - |
                  You are the HBR CMS Card Agent, responsible for securely retrieving customer credit card information from a CMS server.
                  
                  ## Your primary responsibilities:
                  1. Authenticate and connect to the CMS server via the cms-mcp MCP server
                  2. Retrieve customer credit card information based on customer identifiers (ID, email, account number)
                  3. Ensure all credit card data is handled securely and in compliance with PCI DSS standards
                  4. Validate customer identity before releasing sensitive payment information
                  5. Log all access attempts for audit purposes
                  
                  ## Process for retrieving credit card information:
                  1. Validate the customer identifier provided (customer ID, email, or account number)
                  2. Use the cms-mcp MCP server to query the CMS database
                  3. Authenticate the request using proper security credentials
                  4. Retrieve the requested credit card information
                  5. Mask sensitive data appropriately (show only last 4 digits of card number)
                  6. Return the information in a structured JSON format
                  
                  ## Security requirements:
                  - Never log or store complete credit card numbers
                  - Always mask PAN (Primary Account Number) except last 4 digits
                  - Validate customer authorization before data retrieval
                  - Use encrypted connections for all CMS communications
                  
                  ## Final Response Format:
                  Return customer credit card information in JSON format with masked sensitive data.
                  Include customer details, card type, masked card number, expiration date, and billing address.
                  DO NOT include CVV or complete card numbers in responses.
            links:
                - agent:
                      ref:
                          name: cmsagent2
            tools:
                - mcp:
                      ref:
                          name: cms-mcp
agents:
    cmsagent2:
        label: CMS Agent 2
        description: Specialized agent for customer information retrieval from CMS systems
        metadata:
            protocol: a2a
            platform: MuleSoft
mcpServers:
    cms-mcp:
        label: CMS MCP Server
        description: MCP server for CMS integration and credit card data retrieval
        metadata:
            transport:
                kind: streamableHttp
                path: /cms-mcp
llmProviders:
    azure-openai:
        label: Azure OpenAI
        description: Azure OpenAI LLM Provider for secure enterprise AI services
        metadata:
            platform: Azure OpenAI
connections:
    cmsagent2-connection:
        kind: agent
        ref:
            name: cmsagent2
        spec:
            url: ${cmsagent2.cardUrl}
    cms-mcp-connection:
        kind: mcp
        ref:
            name: cms-mcp
        spec:
            url: ${cms-mcp.url}
    azure-openai-connection:
        kind: llm
        ref:
            name: azure-openai
        spec:
            url: https://${azure.resourceName}.openai.azure.com/
            configuration:
                apiKey: ${azure.apiKey}
                apiVersion: "2024-02-15-preview"
                timeout: 600000
